<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Sketched SPNs</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/serif.css">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css">

		<!--  -->
		<style>
			:root {
				--r-background-color: white;
				--palered:    rgb(255, 204, 204);
				--palegreen:  rgb(204, 221, 170);
				--palecyan:   rgb(204, 238, 255);
			}

			.table-container {
				display: flex;
				justify-content: space-around;
				position: relative;
			}
			table {
				border-collapse: collapse;
				border-spacing: 0;       /* remove any default spacing */
				border: 1.5px solid #333;  /* <= add this for the outer border */
				margin: 20px;
			}
			td, th {
				overflow: hidden;
				border: inherit;
				border-collapse: collapse;
				padding: 8px 12px;
				transition: background-color 0.6s ease;
			}
			svg {
				position: absolute;
				top: 0;
				left: 0;
				pointer-events: none;
				width: 100%;
				height: 100%;
			}
			.reveal .slides section {
				overflow: visible !important;
			}

			.flattened {
				height: 0 !important;
				padding: 0 !important;
				font-size: 0 !important;
				transition: all 0.6s ease;
			}

			.flattened td {
				padding: 0 !important;
				border: none;
			}

			.flattened .cell-text {
				opacity: 0;
			}

			@keyframes fadeIn {
				from	{ opacity: 0; }
				to		{ opacity: 1; }
			}

			.fade-in {
				opacity: 0;
				animation: fadeIn 0.8s ease forwards;
			}
			
			#data-x {
				font-size: 2rem;
				position: relative;
				z-index: 1;
			}
		</style>

	</head>
	<body>
		<svg style="height: 0; width: 0; position: absolute;">
		<defs>
			<marker id="arrowhead" markerWidth="10" markerHeight="7"
					refX="8" refY="3.5" orient="auto" markerUnits="strokeWidth">
			<path d="M0,0 L10,3.5 L0,7 Z" fill="black" />
			</marker>
		</defs>
		</svg>
		<div class="reveal">
			<div class="slides">

				<section>
					<h3>Sketched Sum-Product Networks for Joins</h3>
					<!-- add a horizontal line to separate authors from the title -->
					<hr>
					<p>Brian Tsan</p>
					<p>btsan@ucmerced.edu</p>
				</section>

				<section>
					<!-- Distinct header pinned to the very top of this slide -->
					 <header>
						<h4>Concepts</h4>
					 </header>
					<!-- Content container pushed down so it doesn't overlap the header -->
					<div style="padding-top:72px;">
						<ul>
							<li>Joins</li>
							<li>Fast-AGMS Sketches</li>
							<li>Sum-Product Networks</li>
						</ul>
					</div>
				</section>

				<section>
					<section data-auto-animate>
						<header>
							<h4>Joins</h4>
						</header>
						<div>
							<p>A <b>join</b> is a database operation that combines multiple tables.</p>
						</div>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Name</th></tr>
								<tr><td>1</td><td>Alice</td></tr>
								<tr><td>2</td><td>Bob</td></tr>
								<tr><td>3</td><td>Carol</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Score</th></tr>
								<tr><td>2</td><td>88</td></tr>
								<tr><td>3</td><td>92</td></tr>
								<tr><td>4</td><td>75</td></tr>
							</table>
						</div>
					</section>

					<section id="join-slide" class="join-slide"  data-auto-animate>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Name</th></tr>
								<tr data-id="left-unjoined-row"><td>1</td><td>Alice</td></tr>
								<tr id="left-row-2"><td>2</td><td>Bob</td></tr>
								<tr id="left-row-3"><td>3</td><td>Carol</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Score</th></tr>
								<tr id="right-row-2"><td>2</td><td>88</td></tr>
								<tr id="right-row-3"><td>3</td><td>92</td></tr>
								<tr data-id="right-unjoined-row"><td>4</td><td>75</td></tr>
							</table>
						</div>

						<!-- SVG lines between matching rows to be populated via JS -->
						<svg>
						</svg>

						<p>A join takes quadratic time! </p>
						\( \mathcal{O}(n\times m) \)
					</section>

					<section data-auto-animate>
						<div class="table-container" style="gap: 0; justify-content: center;">
							<table data-id="left-table" style="margin-right: 0;">
								<tr><th>ID</th><th>Name</th></tr>
								<tr data-id="left-unjoined-row" class="flattened"><td><span class="cell-text">1</span></td><td><span class="cell-text">Alice</span></td></tr>
								<tr id="left-row-2" style="background-color: var(--palered);"><td>2</td><td>Bob</td></tr>
								<tr id="left-row-3" style="background-color: var(--palecyan);"><td>3</td><td>Carol</td></tr>
							</table>
							<table data-id="right-table" style="margin-left: 0;">
								<tr><th>Score</th></tr>
								<tr id="right-row-2" style="background-color: var(--palered);"><td>88</td></tr>
								<tr id="right-row-3" style="background-color: var(--palecyan);"><td>92</td></tr>
								<tr data-id="right-unjoined-row" class="flattened"><td><span class="cell-text">4</td><td><span class="cell-text">75</span></td></tr>
							</table>
						</div>
					</section>
				</section>

				<section>
					<section data-auto-animate  data-auto-animate-restart>
						<header style="margin-bottom: 20px;">
							<h4>Multi-way Joins</h4>
							<p>How to join more than 2 tables?</p>
						</header>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Student</th></tr>
								<tr><td>1</td><td>Alice</td></tr>
								<tr><td>2</td><td>Bob</td></tr>
								<tr><td>3</td><td>Carol</td></tr>
							</table>
							<table data-id="middle-table">
								<tr><th>SID</th><th>CID</th></tr>
								<tr><td>1</td><td>101</td></tr>
								<tr><td>2</td><td>101</td></tr>
								<tr><td>2</td><td>102</td></tr>
								<tr><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Course</th></tr>
								<tr><td>101</td><td>Calc I</td></tr>
								<tr><td>102</td><td>Lit I</td></tr>
							</table>
						</div>
					</section>

					<section data-auto-animate>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Student</th></tr>
								<tr><td>1</td><td>Alice</td></tr>
								<tr><td>2</td><td>Bob</td></tr>
								<tr><td>3</td><td>Carol</td></tr>
							</table>
							<table data-id="middle-table">
								<tr><th>SID</th><th>CID</th></tr>
								<tr><td>1</td><td>101</td></tr>
								<tr><td>2</td><td>101</td></tr>
								<tr><td>2</td><td>102</td></tr>
								<tr><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Course</th></tr>
								<tr><td>101</td><td>Calc I</td></tr>
								<tr><td>102</td><td>Lit I</td></tr>
							</table>
						</div>

						<p>Join with <b>Students</b> (left) or <b>Courses</b> (right) first?</p>
					</section>
					
					<section id="join-student-slide-1" data-auto-animate>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Student</th></tr>
								<tr id><td>1</td><td>Alice</td></tr>
								<tr><td>2</td><td>Bob</td></tr>
								<tr style="font-size: 0;"><td>2</td><td>Bob</td></tr>
								<tr><td>3</td><td>Carol</td></tr>
							</table>
							<table data-id="middle-table">
								<tr><th>SID</th><th>CID</th></tr>
								<tr><td>1</td><td>101</td></tr>
								<tr><td>2</td><td>101</td></tr>
								<tr><td>2</td><td>102</td></tr>
								<tr><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Course</th></tr>
								<tr><td>101</td><td>Calc I</td></tr>
								<tr><td>102</td><td>Lit I</td></tr>
							</table> 
						</div>

						<p>Cost of joining with <b>Students</b> (left) first:</p>
						<p>\( \lvert \mathrm{Students} \rvert \times \lvert \mathrm{Enrolled} \rvert = 12\)</p>
					</section>
					
					<section id="join-student-slide-2" data-auto-animate>
						<div class="table-container" style="gap: 0; justify-content: center;">
							<table data-id="left-table" style="margin-right: 0;">
								<tr><th>Student</th></tr>
								<tr style="background-color: var(--palered);"><td>Alice</td></tr>
								<tr style="background-color: var(--palegreen);"><td>Bob</td></tr>
								<tr style="background-color: var(--palegreen);"><td>Bob</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Carol</td></tr>
							</table>
							<table data-id="middle-table" style="margin-left: 0; margin-right: 0;">
								<tr><th>SID</th><th>CID</th></tr>
								<tr style="background-color: var(--palered);"><td>1</td><td>101</td></tr>
								<tr style="background-color: var(--palegreen);"><td>2</td><td>101</td></tr>
								<tr style="background-color: var(--palegreen);"><td>2</td><td>102</td></tr>
								<tr style="background-color: var(--palecyan);"><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Course</th></tr>
								<tr><td>101</td><td>Calc I</td></tr>
								<tr style="font-size: 0;"><td>101</td><td>Calc I</td></tr>
								<tr><td>102</td><td>Lit I</td></tr>
								<tr style="font-size: 0;"><td>102</td><td>Lit I</td></tr>
							</table> 
						</div>

						<p>Cost of joining with <b>Students</b> (left) first:</p>
						<p>\( \lvert \mathrm{Students} \rvert \times \lvert \mathrm{Enrolled} \rvert = 12\)</p>
						<p>\( + \lvert \mathrm{Students} \bowtie \mathrm{Enrolled} \rvert \times \lvert \mathrm{Courses} \rvert = 24\)</p>
					</section>

					<section id="join-student-slide-3" data-auto-animate>
						<div class="table-container" style="gap: 0; justify-content: center;">
							<table data-id="left-table" style="margin-right: 0;">
								<tr><th>Student</th></tr>
								<tr style="background-color: var(--palered);"><td>Alice</td></tr>
								<tr style="background-color: var(--palegreen);"><td>Bob</td></tr>
								<tr style="background-color: var(--palegreen);"><td>Bob</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Carol</td></tr>
							</table>
							<table data-id="middle-table" style="margin-left: 0; margin-right: 0;">
								<tr><th>SID</th><th>CID</th></tr>
								<tr style="background-color: var(--palered);"><td>1</td><td>101</td></tr>
								<tr style="background-color: var(--palegreen);"><td>2</td><td>101</td></tr>
								<tr style="background-color: var(--palegreen);"><td>2</td><td>102</td></tr>
								<tr style="background-color: var(--palecyan);"><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table" style="margin-left: 0;">
								<tr><th>Course</th></tr>
								<tr style="background-color: var(--palered);"><td>Calc I</td></tr>
								<tr style="background-color: var(--palegreen);"><td>Calc I</td></tr>
								<tr style="background-color: var(--palegreen);"><td>Lit I</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Lit I</td></tr>
							</table> 
						</div>

						<p>Cost of joining with <b>Students</b> (left) first:</p>
						<p>\( \lvert \mathrm{Students} \rvert \times \lvert \mathrm{Enrolled} \rvert = 12\)</p>
						<p>\( + \lvert \mathrm{Students} \bowtie \mathrm{Enrolled} \rvert \times \lvert \mathrm{Courses} \rvert = 24\)</p>
					</section>

					<section id="join-courses-slide-1" data-auto-animate>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Student</th></tr>
								<tr><td>1</td><td>Alice</td></tr>
								<tr><td>2</td><td>Bob</td></tr>
								<tr><td>3</td><td>Carol</td></tr>
							</table>
							<table data-id="middle-table">
								<tr><th>SID</th><th>CID</th></tr>
								<tr><td>1</td><td>101</td></tr>
								<tr><td>2</td><td>101</td></tr>
								<tr><td>2</td><td>102</td></tr>
								<tr><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Course</th></tr>
								<tr><td>101</td><td>Calc I</td></tr>
								<tr style="font-size: 0;"><td>101</td><td>Calc I</td></tr>
								<tr><td>102</td><td>Lit I</td></tr>
								<tr style="font-size: 0;"><td>102</td><td>Lit I</td></tr>
							</table> 
						</div>

						<p>Cost of joining with <b>Courses</b> (right) first:</p>
						<p>\( \lvert \mathrm{Enrolled} \rvert \times \lvert \mathrm{Courses} \rvert = 8\)</p>
					</section>

					<section id="join-courses-slide-2" data-auto-animate>
						<div class="table-container" style="gap: 0; justify-content: center;">
							<table data-id="left-table">
								<tr><th>ID</th><th>Student</th></tr>
								<tr><td>1</td><td>Alice</td></tr>
								<tr><td>2</td><td>Bob</td></tr>
								<tr style="font-size: 0;"><td>2</td><td>Bob</td></tr>
								<tr><td>3</td><td>Carol</td></tr>
							</table>
							<table data-id="middle-table" style="margin-right: 0;">
								<tr><th>SID</th><th>CID</th></tr>
								<tr style="background-color: var(--palered);"><td>1</td><td>101</td></tr>
								<tr style="background-color: var(--palered);"><td>2</td><td>101</td></tr>
								<tr style="background-color: var(--palecyan);"><td>2</td><td>102</td></tr>
								<tr style="background-color: var(--palecyan);"><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table" style="margin-left: 0;">
								<tr><th>Course</th></tr>
								<tr style="background-color: var(--palered);"><td>Calc I</td></tr>
								<tr style="background-color: var(--palered);"><td>Calc I</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Lit I</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Lit I</td></tr>
							</table> 
						</div>

						<p>Cost of joining with <b>Courses</b> (right) first:</p>
						<p>\( \lvert \mathrm{Enrolled} \rvert \times \lvert \mathrm{Courses} \rvert = 8\)</p>
						<p>\( + \lvert \mathrm{Students} \rvert \times \lvert \mathrm{Enrolled} \Join \mathrm{Courses} \rvert = 20\)</p>
					</section>
					
					<section data-auto-animate>
						<div class="table-container" style="gap: 0; justify-content: center;">
							<table data-id="left-table" style="margin-right: 0;">
								<tr><th>Student</th></tr>
								<tr style="background-color: var(--palered);"><td>Alice</td></tr>
								<tr style="background-color: var(--palered);"><td>Bob</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Bob</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Carol</td></tr>
							</table>
							<table data-id="middle-table" style="margin-left: 0; margin-right: 0;">
								<tr><th>SID</th><th>CID</th></tr>
								<tr style="background-color: var(--palered);"><td>1</td><td>101</td></tr>
								<tr style="background-color: var(--palered);"><td>2</td><td>101</td></tr>
								<tr style="background-color: var(--palecyan);"><td>2</td><td>102</td></tr>
								<tr style="background-color: var(--palecyan);"><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table" style="margin-left: 0;">
								<tr><th>Course</th></tr>
								<tr style="background-color: var(--palered);"><td>Calc I</td></tr>
								<tr style="background-color: var(--palered);"><td>Calc I</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Lit I</td></tr>
								<tr style="background-color: var(--palecyan);"><td>Lit I</td></tr>
							</table> 
						</div>

						<p>Cost of joining with <b>Courses</b> (right) first:</p>
						<p>\( \lvert \mathrm{Enrolled} \rvert \times \lvert \mathrm{Courses} \rvert = 8\)</p>
						<p>\( + \lvert \mathrm{Students} \rvert \times \lvert \mathrm{Enrolled} \Join \mathrm{Courses} \rvert = 20\)</p>
						<em>Same result, lower cost!</em>
					</section>
				</section>

				<section>
					<section data-auto-animate data-auto-animate-restart>
						<header style="margin-bottom: 20px;">
							<h4>Tug-of-War Sketch</h4>
							<p>A probabilistic join size estimator.</p>
						</header>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Name</th></tr>
								<tr><td data-id="l1">1</td><td>Alice</td></tr>
								<tr><td data-id="l2">2</td><td>Bob</td></tr>
								<tr><td data-id="l3">3</td><td>Carol</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Score</th></tr>
								<tr><td data-id="r1">2</td><td>88</td></tr>
								<tr><td data-id="r2">3</td><td>92</td></tr>
								<tr><td data-id="r3">4</td><td>75</td></tr>
							</table>
						</div>
					</section>

					<section id="hash-slide" data-auto-animate>
						<div class="table-container" style="margin-bottom: 1in;">
							<table id="left-ids" data-id="left-table">
								<tr><td data-id="l1">1</td><td data-id="l2">2</td><td data-id="l3">3</td></tr>
							</table>
							<table id="right-ids" data-id="right-table">
								<tr><td data-id="r1">2</td><td data-id="r2">3</td><td data-id="r3">4</td></tr>
							</table>
						</div>

						<!-- To be populated in JS -->
						<svg></svg>
						
						<div class="table-container">
							<table id="left-hashes" data-id="left-hashes">
								<tr><td class="fade-in" style="animation-delay: 0.2s">-1</td><td class="fade-in" style="animation-delay: 0.4s">1</td><td class="fade-in" style="animation-delay: 0.6s">-1</td></tr>
							</table>
							<table id="right-hashes" data-id="right-hashes">
								<tr><td class="fade-in" style="animation-delay: 0.8s">1</td><td class="fade-in" style="animation-delay: 1s">-1</td><td class="fade-in" style="animation-delay: 1.2s">1</td></tr>
							</table>
						</div>

						<p>Hash with $\xi: \mathbb{R} \rightarrow \pm 1$</p>
						<p class="fragment">$\xi$ is <b>pairwise independent</b>!</p>
						<p class="fragment">\( \mathbb{E}\left[\xi(x)\xi(y)\right] = 0  \) for any $x \neq y$</p>
					</section>

					<section data-auto-animate>
						<div class="table-container" style="margin-bottom: 1in;">
							<table data-id="left-table">
								<tr><td data-id="l1">1</td><td data-id="l2">2</td><td data-id="l3">3</td></tr>
							</table>
							<table data-id="right-table">
								<tr><td data-id="r1">2</td><td data-id="r2">3</td><td data-id="r3">4</td></tr>
							</table>
						</div>

						<!-- To be populated in JS -->
						<svg></svg>
						
						<div class="table-container">
							<table data-id="left-hashes">
								<tr><td>-1</td><td>1</td><td>-1</td></tr>
							</table>
							<table data-id="right-hashes">
								<tr><td>1</td><td>-1</td><td>1</td></tr>
							</table>
						</div>

						<p>$(-1 + 1 - 1)(1 - 1 + 1)$</p>
						<p class="fragment">$(-1)(1)$</p>
						<p class="fragment">$\approx \lvert A \Join B \rvert$</p>
						<p class="fragment">This estimate is incorrect!</p>
						<p class="fragment">But what about the <em>mean</em> of multiple estimators?</p>
					</section>

					<section data-auto-animate>
						<header style="margin-bottom: 1in;">
							<h5>Unbiased estimation proof</h5>
						</header>

						<p class="fragment">Sketch of $A$: $\sum_{x \in A} \xi(x)$</p>
						<p class="fragment">Sketch of $B$: $\sum_{y \in B} \xi(y)$</p>
					</section>

					<section data-auto-animate>
						<p>Join size estimate:</p> 
						<p>$\mathopen{\big(} \sum_{x \in A} \xi(x) \mathclose{\big)}
						\mathopen{\big(} \sum_{y \in B} \xi(y) \mathclose{\big)}$</p>

						<span class="fragment" data-id="pairwise-sum">$\sum_{x = y} \xi(x)\xi(y) + \sum_{x \neq y} \xi(x)\xi(y)$</span>
						<p class="fragment">Recall that $\xi$ is <em>pairwise independent</em>.</p>
					</section>

					<section data-auto-animate>
						<span class="fragment" data-fragment-index="1">$\mathbb{E}\mathclose{\big[}$</span>
							<span data-id="pairwise-sum">$\sum_{x = y} \xi(x)\xi(y) + \sum_{x \neq y} \xi(x)\xi(y)$</span>
						<span class="fragment" data-fragment-index="1">$\mathclose{\big]}$</span>
						<p class="fragment">$\mathbb{E}\mathclose{\big[}\sum_{x = y} \xi(x)\xi(y)\mathclose{\big]} + \mathbb{E}\mathclose{\big[}\sum_{x \neq y} \xi(x)\xi(y)\mathclose{\big]}$</p>
						<p class="fragment"><span data-id="pairwise-one">$\mathbb{E}\mathclose{\big[}\sum_{x = y} 1\mathclose{\big]}$</span>$\,{+}\,\mathbb{E}\mathclose{\big[}\sum_{x \neq y} 0 \mathclose{\big]}$</p>
					</section>

					<section data-auto-animate>
						<span data-id="pairwise-one">$\mathbb{E}\mathclose{\big[}\sum_{x = y} 1\mathclose{\big]}$</span>
						<span class="fragment">$= \lvert A \Join B \rvert $</span>
						<p class="fragment">Thus, the (expected) product of Tug-of-War sketches is the join size!</p>
						<p class="fragment" style="margin-top: 1.5in; font-size: 12px;">Noga Alon, Phillip B. Gibbons, Yossi Matias, and Mario Szegedy. 1999. Tracking join and self-join sizes in limited storage. In Proceedings of the eighteenth ACM SIGMOD-SIGACT-SIGART symposium on Principles of database systems (PODS '99). Association for Computing Machinery, New York, NY, USA, 10–20. <a href="https://doi.org/10.1145/303976.303978">https://doi.org/10.1145/303976.303978</a></p>
					</section>
				</section>

				<section>
					<section id="sketch-slide" data-auto-animate data-auto-animate-restart>
						<header>
							<h4>Fast-AGMS Sketches</h4>
							<p>How to make the Tug-of-War sketch <em>fast</em>?</p>
						</header>

						<div id="sketch-container" style="position: relative; width: 100%; height: 300px;">
							<svg id="sketch-svg" width="100%" heigh="100%" viewbox="0 0 200 200" style="position: absolute; top: 0; left: 0;">
							</svg>
							<div id="agms-1" style="position: absolute; left: 35%; top: 10%; font-size: 1.25rem;">$\sum_x \xi_1(x)$</div>
							<div id="agms-2" style="position: absolute; left: 25%; top: 30%; font-size: 1.25rem;">$\sum_x \xi_2(x)$</div>
							<div id="agms-3" style="position: absolute; left: 30%; top: 50%; font-size: 1.25rem;">$\sum_x \xi_3(x)$</div>
							<div id="agms-4" style="position: absolute; left: 25%; top: 70%; font-size: 1.25rem;">$\sum_x \xi_4(x)$</div>
							<div id="agms-5" style="position: absolute; left: 35%; top: 90%; font-size: 1.25rem;">$\sum_x \xi_5(x)$</div>

							<div style="display: flex; align-items: center; justify-content: center; height: 100%;">
								<span id="data-x">$X$</span>
							</div>

							<table id="fast-agms" style="position: absolute; left: 60%; top: 14%; font-size: 1.25rem;">
								<tr><td>$\sum_{x: h(x) = 1}\xi(x)$</td></tr>
								<tr><td>$\sum_{x: h(x) = 2}\xi(x)$</td></tr>
								<tr><td>$\sum_{x: h(x) = 3}\xi(x)$</td></tr>
								<tr><td>$\sum_{x: h(x) = 4}\xi(x)$</td></tr>
								<tr><td>$\sum_{x: h(x) = 5}\xi(x)$</td></tr>
							</table>
						</div>
						<p class="fragment" style="margin-top: 0.25in; font-size: 12px;">Graham Cormode and Minos Garofalakis. 2005. Sketching streams through the net: distributed approximate query tracking. In Proceedings of the 31st international conference on Very large data bases (VLDB '05). VLDB Endowment, 13–24.</p>
					</section>
					
					<section data-auto-animate>
						<header style="margin-bottom: 20px;">
							<h5>Multi-way Join with Fast-AGMS</h4>
						</header>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Student</th></tr>
								<tr><td data-id="l1">1</td><td>Alice</td></tr>
								<tr><td data-id="l2">2</td><td>Bob</td></tr>
								<tr><td data-id="l3">3</td><td>Carol</td></tr>
							</table>
							<table data-id="middle-table">
								<tr><th>SID</th><th>CID</th></tr>
								<tr><td data-id="ml1">1</td><td data-id="mr1">101</td></tr>
								<tr><td data-id="ml2">2</td><td data-id="mr2">101</td></tr>
								<tr><td data-id="ml3">2</td><td data-id="mr3">102</td></tr>
								<tr><td data-id="ml4">3</td><td data-id="mr4">102</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Course</th></tr>
								<tr><td data-id="r1">101</td><td>Calc I</td></tr>
								<tr><td data-id="r2">102</td><td>Lit I</td></tr>
							</table>
						</div>
					</section>

					<section id="fast-agms-slide" style="font-size: 1.5rem;" data-auto-animate>
						<div class="table-container">
							<table id="left-ids-2" data-id="left-table">
								<tr style="background-color: var(--palered);"><th>$x$</th><td data-id="l1">1</td><td data-id="l2">2</td><td data-id="l3">3</td></tr>
							</table>
							<table id="middle-ids-2" data-id="middle-table">
								<tr style="background-color: var(--palered);"><th>$x$</th><td data-id="ml1">1</td><td data-id="ml2">2</td><td data-id="ml3">2</td><td data-id="ml4">3</td></tr>
								<tr style="background-color: var(--palecyan);"><th>$y$</th><td data-id="mr1">101</td><td data-id="mr2">101</td><td data-id="mr3">102</td><td data-id="mr4">102</td></tr>
							</table>
							<table id="right-ids-2" data-id="right-table">
								<tr style="background-color: var(--palecyan);"><th>$y$</th><td data-id="r1">101</td><td data-id="r2">102</td></tr>
							</table>
						</div>

						<svg></svg>

						<div class="table-container" style="margin-top: 1in;">
							<table id="left-hashes-2" data-id="left-hashes">
								<tr style="background-color: var(--palered);"><th>$\xi_1(x)$</th><td>-1</td><td>1</td><td>-1</td></tr>
								<tr style="background-color: var(--palered);"><th>$h_1(x)$</th><td>2</td><td>1</td><td>3</td></tr>
							</table>
							<table id="middle-hashes-2" data-id="middle-hashes">
								<tr style="background-color: var(--palered);"><th>$\xi_1(x)$</th><td>-1</td><td>1</td><td>1</td><td>-1</td></tr>
								<tr style="background-color: var(--palered);"><th>$h_1(x)$</th><td>2</td><td>1</td><td>1</td><td>3</td></tr>
								<tr style="background-color: var(--palecyan);"><th>$\xi_2(y)$</th><td>-1</td><td>-1</td><td>-1</td><td>-1</td></tr>
								<tr style="background-color: var(--palecyan);"><th>$h_2(y)$</th><td>2</td><td>2</td><td>3</td><td>3</td></tr>
							</table>
							<table id="right-hashes-2" data-id="right-hashes">
								<tr style="background-color: var(--palecyan);"><th>$\xi_2(y)$</th><td>-1</td><td>-1</td></tr>
								<tr style="background-color: var(--palecyan);"><th>$h_2(y)$</th><td>2</td><td>3</td></tr>
							</table>
						</div>

						<p>Where $h: \mathbb{R}\rightarrow\{1, 2, 3\}$</p>
						<p class="fragment">Use differently seeded $\xi$ hash functions for each join!</p>
					</section>

					<section style="font-size: 1.5rem;" data-auto-animate>
						<div class="table-container">
							<div style="display: flex; flex-direction: column;">
								<table id="left-hashes-2" data-id="left-hashes">
									<tr style="background-color: var(--palered);"><th>$\xi_1(x)$</th><td>-1</td><td>1</td><td>-1</td></tr>
									<tr style="background-color: var(--palered);"><th>$h_1(x)$</th><td>2</td><td>1</td><td>3</td></tr>
								</table>

								<span data-id="left-sketch">
									$$
										\begin{bmatrix} 
											1 & -1 & -1
										\end{bmatrix}
									$$
								</span>
							</div>
							<div style="display: flex; flex-direction: column;">
								<table id="middle-hashes-2" style="margin-bottom: 0.5in;" data-id="middle-hashes">
									<tr style="background-color: var(--palered);"><th>$\xi_1(x)$</th><td>-1</td><td>1</td><td>1</td><td>-1</td></tr>
									<tr style="background-color: var(--palered);"><th>$h_1(x)$</th><td>2</td><td>1</td><td>1</td><td>3</td></tr>
									<tr style="background-color: var(--palecyan);"><th>$\xi_2(y)$</th><td>-1</td><td>-1</td><td>-1</td><td>-1</td></tr>
									<tr style="background-color: var(--palecyan);"><th>$h_2(y)$</th><td>2</td><td>2</td><td>3</td><td>3</td></tr>
								</table>

								<span data-id="middle-sketch">
									$$\Bigg[
									\begin{array}{ccc}
									0 & -1 & -1 \\
									0 & 1 & 0 \\
									0 & 0 & 1
									\end{array}
									\Bigg]$$
								</span>
							</div>
							<div style="display: flex; flex-direction: column;">
								<table id="right-hashes-2" data-id="right-hashes">
									<tr style="background-color: var(--palecyan);"><th>$\xi_2(y)$</th><td>-1</td><td>-1</td></tr>
									<tr style="background-color: var(--palecyan);"><th>$h_2(y)$</th><td>2</td><td>3</td></tr>
								</table>

								<span data-id="right-sketch">
									$$
										\begin{bmatrix} 
											0 & -1 & -1
										\end{bmatrix}
									$$
								</span>
							</div>
						</div>
					</section>

					<section style="font-size: 1.5rem;" data-auto-animate>
						<div class="table-container">
							<div style="display: flex; flex-direction: column;">
								$A$
								<span data-id="left-sketch">
									$$
										\begin{bmatrix} 
											1 & -1 & -1
										\end{bmatrix}
									$$
								</span>
							</div>
							<div style="display: flex; flex-direction: column;">
								$B$
								<span data-id="middle-sketch">
									$$\Bigg[
									\begin{array}{ccc}
									0 & -1 & -1 \\
									0 & 1 & 0 \\
									0 & 0 & 1
									\end{array}
									\Bigg]$$
								</span>
							</div>
							<div style="display: flex; flex-direction: column;">
								$C$
								<span data-id="right-sketch">
									$$
										\begin{bmatrix} 
											0 & -1 & -1
										\end{bmatrix}
									$$
								</span>
							</div>
						</div>
						<p class="fragment">$A \cdot B = \begin{bmatrix}0 & -2 & -2\end{bmatrix}$</p>
						<p class="fragment">$A \cdot B \cdot C = 4$</p>
						<p class="fragment">$=\lvert Students \Join Enrolled \Join Courses \rvert$</p>
					</section>
				</section>
				
				<section>
					<section style="font-size: 1.5rem;" data-auto-animate data-auto-animate-restart>
						<header style="margin-bottom: 20px;">
							<h4>Joins Subject to Filters</h4>
							<p>Where the join inputs have unknown sizes</p>
						</header>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Student</th><th>Year</th></tr>
								<tr><td>1</td><td>Alice</td><td>2</td></tr>
								<tr><td>2</td><td>Bob</td><td>1</td></tr>
								<tr><td>3</td><td>Carol</td><td>2</td></tr>
							</table>
							<table data-id="middle-table">
								<tr><th>SID</th><th>CID</th></tr>
								<tr><td>1</td><td>101</td></tr>
								<tr><td>2</td><td>101</td></tr>
								<tr><td>2</td><td>102</td></tr>
								<tr><td>3</td><td>102</td></tr>
							</table>
							<table data-id="right-table">
								<tr><th>ID</th><th>Course</th></tr>
								<tr><td>101</td><td>Calc I</td></tr>
								<tr><td>102</td><td>Lit I</td></tr>
							</table>
						</div>
						\( \sigma_{\mathrm{Year}=1}(\mathrm{Students}) \Join \mathrm{Enrolled} \Join \mathrm{Courses} \)
						<p class="fragment">We have the sketch of $\mathrm{Students}$ but not $\sigma_{\mathrm{Year}=1}(\mathrm{Students})$</p>
						<p class="fragment">Proposed solution: generate the sketch using a <em>Sum-Product Network</em>!</p>
					</section>
					
					<section style="font-size: 1.5rem;" data-auto-animate>
						<header style="margin-bottom: 20px;">
							<h4>Sum-Product Networks</h4>
							<p>A probabilistic model for multivariate data</p>
						</header>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th>ID</th><th>Student</th><th>Year</th></tr>
								<tr><td>1</td><td>Alice</td><td>2</td></tr>
								<tr><td>2</td><td>Bob</td><td>1</td></tr>
								<tr><td>3</td><td>Carol</td><td>2</td></tr>
							</table>
						</div>

						<p>Main idea: $P(X, Y) = P(X) \times P(Y)$ when $X$ and $Y$ are independent</p>
					</section>

					<section style="font-size: 1.5rem;" data-auto-animate>
						<div class="table-container">
							<table data-id="left-table">
								<tr><th data-id="id">ID</th><th data-id="s">Student</th><th data-id="y">Year</th></tr>
								<tr><td data-id="id-1">1</td><td data-id="s-1">Alice</td><td data-id="y-1">2</td></tr>
								<tr><td data-id="id-2">2</td><td data-id="s-2">Bob</td><td data-id="y-2">1</td></tr>
								<tr><td data-id="id-3">3</td><td data-id="s-3">Carol</td><td data-id="y-3">2</td></tr>
							</table>
						</div>

						<p>Main idea: $P(X, Y) = P(X) \times P(Y)$ when $X$ and $Y$ are independent</p>
					</section>
					
					<section style="font-size: 1.5rem;" data-auto-animate>

						<p>Approximate the sketch of <b>ID</b> where <b>Year</b>= 1</p>

						<div class="table-container">
							<div style="display: flex; flex-direction: column;">
								<table style="margin-bottom: 0.5in;">
									<tr><th data-id="id">ID</th></tr>
									<tr><td data-id="id-1">1</td></tr>
									<tr><td data-id="id-2">2</td></tr>
									<tr><td data-id="id-3">3</td></tr>
								</table>

								<span class="fragment" data-id="sketch-id">$\mathcal{S}(\mathrm{ID})$</span>
							</div>

							<div style="display: flex; flex-direction: column;">
								<table style="margin-bottom: 0.5in;">
									<tr><th data-id="s">Student</th></tr>
									<tr><td data-id="s-1">Alice</td></tr>
									<tr><td data-id="s-2">Bob</td></tr>
									<tr><td data-id="s-3">Carol</td></tr>
								</table>

								<span class="fragment" data-id="margin-out">$1$</span>
							</div>

							<div style="display: flex; flex-direction: column;">
								<table style="margin-bottom: 0.5in;">
									<tr><th data-id="y">Year</th></tr>
									<tr><td data-id="y-1">2</td></tr>
									<tr><td data-id="y-2">1</td></tr>
									<tr><td data-id="y-3">2</td></tr>
								</table>

								<span class="fragment" data-id="year=1">$P(\mathrm{Year}=1) = \frac{1}{3}$</span>
							</div>
						</div>

						<p class="fragment" style="margin-top: 0.8in;">$\mathcal{S}\left(\pi_{\mathrm{\tiny{ID}}}\sigma_{\tiny{\mathrm{Year}=1}}\left(\mathrm{Students}\right)\right)$</p>
						<p class="fragment">$\approx\mathcal{S}(\mathrm{ID}) \times \frac{1}{3}$</p>
					</section>

					<section style="font-size: 1.5rem;" data-auto-animate>
						<header>
							<h5>LearnSPN</h5>
						</header>

						<div>
							<ol>
								<li class="fragment">If the data is one column, make a leaf node and terminate.</li>
								<li class="fragment">If possible, split columns into independent groups — a product node.</li>
								<li class="fragment">Otherwise, cluster the rows and make a sum node.</li>
							</ol>
						</div>

						<div style="display: flex; justify-content: center; align-items: center; height: 50%;">
							<img src="images/learn_spn.png" style="max-width: 50%; max-height: 50%;">
						</div>

						<p class="fragment" style="font-size: 12px;">
Gens, R. &amp; Pedro, D.. (2013). Learning the Structure of Sum-Product Networks. <i>Proceedings of the 30th International Conference on Machine Learning</i>, in <i>Proceedings of Machine Learning Research</i> 28(3):873-880 Available from <a href="https://proceedings.mlr.press/v28/gens13.html">https://proceedings.mlr.press/v28/gens13.html</a>.
</p>
					</section>

					<section style="font-size: 1.5rem;" data-auto-animate>

						<p>Inference — traverse network depth-first and aggregate up.</p>

						<div style="display: flex; justify-content: center; align-items: center; height: 100%;">
							<img src="images/learn_spn.png" style="max-width: 50%; max-height: 50%;">
							<img src="images/infer_spn.png" style="max-width: 50%; max-height: 50%;">
						</div>

						<p>Example: estimating $P(Z; X=x_2)$</p>
					</section>

					<section style="font-size: 1.5rem;" data-auto-animate>
						<header>
							<h5>Sketched SPNs</h4>
							<p>Have one SPN for each table to approximate any sketch for any query.</p>
						</header>

						<div class="fragment" style="display: flex; justify-content: center; align-items: center; height: 100%;">
							<img src="images/sketched_spns.png" style="max-width: 50%; max-height: 50%;">
						</div>
					</section>
				</section>

				<section>
					<section style="font-size: 1.5rem;">
						<header>
							<h4>Experiments</h4>
						</header>

						<table style="margin-top: 0.5in; margin-bottom: 0.5in;">
							<tr><th>Workload</th><th>Dataset</th><th>Tables</th><th>Queries</th><th>Subqueries</th></tr>
							<tr><td>JOB-light</td><td>IMDb</td><td>6</td><td>70</td><td>696</td></tr>
							<tr><td>Stats-CEB</td><td>Stats Stack Exchange</td><td>8</td><td>146</td><td>2603</td></tr>
						</table>
						<p data-fragment-index="1" class="fragment" style="font-size: 12px;">Kipf, Andreas, et al. "Learned cardinalities: Estimating correlated joins with deep learning." arXiv preprint arXiv:1809.00677 (2018).</p>
						<p data-fragment-index="1" class="fragment" style="font-size: 12px;">Han, Yuxing, et al. "Cardinality estimation in DBMS: A comprehensive benchmark evaluation." arXiv preprint arXiv:2109.05877 (2021).</p>
					</section>
					
					<section style="font-size: 1.5rem;">
						<header>
							<h6>Accuracy and Inference Time on Subqueries</h6>
						</header>

						<div style="display: flex;">
							<div class="diagram">
								<object type="image/svg+xml" data="images/estimation_heatmaps.svg"></object>
							</div>
							<div style="display: flex; flex-direction: column; width: auto; justify-content: center; align-items: center; margin-left: 0.3in;">
								<ul>
									<li><b>Q-error</b> aka multiplcative error — ratio between target and estimate.</li>
									<li><b>Clustering Threshold</b> — minimum size of SPN clusters, proportional to original table size.</li>
									<li><b>Independence Threshold</b> — any pair of columns that are at least this dependent remain grouped.</li>
								</ul>
							</div>
						</div>
					</section>

					<section style="font-size: 1.5rem;">
						<header>
							<h6>Total Execution Time on Workloads</h6>
						</header>

						<div class="diagram">
							<object type="image/svg+xml" data="images/query_execution_times.svg"></object>
						</div>

						Join size estimates from different estimators are plugged into the PostgreSQL.
						<ul>
							<li class="fragment"><b>SPNs</b>: DeepDB, FLAT, ours ($\dagger$ and $\ddagger$)</li>
							<li class="fragment"><b>Bayes Nets</b>: BayesCard, FactorJoin</li>
							<li class="fragment">F-AGMS Max is the maximum estimate of multiple F-AGMS sketches.</li>
							<li class="fragment">Bound Sketch is a <em>pessimistic</em> join size estimator.</li>
							<li class="fragment">In query execution time, it's safer to overestimate than underestimate.</li>
						</ul>
					</section>

					<section style="font-size: 1.5rem;">
						<header>
							<h6>Relative Error Distribution</h6>
						</header>

						<div style="display: flex;">
							<div class="diagram" style="max-width: 50%;">
								<object type="image/svg+xml" data="images/relerror_dist.svg"></object>
							</div>
							<div style="display: flex; flex-direction: column; width: auto; justify-content: center; align-items: center; margin-left: 0.5in;">
								<ul>
									<li>Our F-AGMS Max heuristic largely prevents underestimations.</li>
									<li>Still very accurate — not overestimating as much as Bound Sketch.</li>
								</ul>
							</div>
						</div>
					</section>
				</section>

				<section>
					<header style="margin: 0.3in;">
						<h4>Conclusions</h4>
					</header>

					<div style="display: flex; width: 100%;">
						<div style="max-width: 50%; font-size: 14px; margin-right: 0.3in;">
							<img src="images/qr.png" style="max-width: 100%; max-height: 100%;">
							<a href="https://arxiv.org/abs/2506.14034">https://arxiv.org/abs/2506.14034</a>
						</div>
						<ul>
							<li>Sketches are highly accurate join size estimators.</li>
							<li>SPNs can efficiently approximate sketches.</li>
							<li>Remaining challenges: scaling to more joins, handling LIKE and other complex filters.</li>
						</ul>
					</div>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script src="plugin/math/math.js"></script>
		<script src="animations.js">
			//custom animations
		</script> 
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				// backgroundTransition: 'none',
				hash: true,

				// add slide number
				slideNumber: "c/t",

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes, RevealMath.KaTeX ]
			});

			function onMaybeDraw() {
				const slide = Reveal.getCurrentSlide();
				if (slide) {
					console.log(slide.id);
					if (slide.id === 'join-slide') {
						drawJoinLines();
					}
					else if (slide.id === 'hash-slide') {
						drawHashLines(slide.id);
					}
					else if (slide.id === 'sketch-slide') {
						drawSketches();
					}
					else if (slide.id === 'fast-agms-slide') {
						drawHashLines2();
					}
				}
			}

			Reveal.on('ready',       onMaybeDraw);
			Reveal.on('slidechanged', onMaybeDraw);
			Reveal.on('resize',      onMaybeDraw);

		</script>
	</body>
</html>
